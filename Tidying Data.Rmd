---
title: "Gathering Data"
author: "Ifechi Umeh"
date: "3/28/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
```


*states vs countries. 

```{r}
waste_total <- read_csv("Data Raw/plastic-waste-generation-total.csv")

waste_per_cap <- read_csv("Data Raw/plastic-waste-per-capita.csv")
waste_per_cap <-  waste_per_cap %>% 
                    select(c("Entity", "Per capita plastic waste (kg/person/day)"))

waste_totgbl_mismanage <- read_csv("Data Raw/mismanaged-waste-global-total.csv")
waste_totgbl_mismanage <-  waste_totgbl_mismanage %>% 
                             select(c("Entity", "Mismanaged waste (% global total)"))

waste_inadequate_manage <- read_csv("Data Raw/inadequately-managed-plastic.csv")
waste_inadequate_manage <-  waste_inadequate_manage %>% 
                            select(c("Entity", "Share of plastic inadequately managed"))
```

*Plastic data from Our World in Data

```{r}
pop <- read_csv("Data Raw/export.csv")
pop <- pop %>% 
        select(c("Country/Area Name", "Population", "Annual Growth Rate %", "Area (sq km)", "Density (per sq km)"))
```

Note: A lot of the N/a's in the wiki webpage are smaller Islands nations/ territories. I would be a little uncomfortable with imputing this data since it is Informed Missing. I found that we could find some of those missing values

*changed the population since Wikipedia is not a reliable source. Data from Census Bureau



```{r}
country_gdp <- read_csv("Data Raw/Country-GPD-per-capita.csv")

country_gdp_capita <- country_gdp %>% transmute(Entity = `GDP per capita, current prices
 (U.S. dollars per capita)`,
 gdp_per_capita = `2010`)

gdp_per_cap <- country_gdp_capita[c(2:197),] #to ensure we have just the countries and not regions
```

*"GDP per capita, current prices (U.S. dollars per capita)": Data from IMF

"Gross domestic product is the most commonly used single measure of a country's overall economic activity. It represents the total value at current prices of final goods and services produced within a country during a specified time period divided by the average population for the same one year.

Source: World Economic Outlook (October 2021)" https://www.imf.org/external/datamapper/NGDPDPC@WEO/OEMDC/ADVEC/WEOWORLD 


```{r}
# This might be a pain to clean up since the data includes a lot of regions but we are concentrating on individual countries.
#gdp_country <- read_csv("Data Raw/World Bank GDP data/World bank gdp.csv") 

#gdp_country <- gdp_country %>% 
#  rename("Entity" = `Country Name`,
#         "GPD (in USD 2015)" = `2010`,
#         "Code" = `Country Code`) %>% 
#  select(Entity, `GPD (in USD 2015)`)


## Alternatively, we can calculate GDP using population and gdp_per capita
```

```{r}
tab1 <- full_join(waste_total, pop, by = c("Entity" = "Country/Area Name"))
tab2 <- full_join(tab1, waste_per_cap, by = c("Entity"))
tab3 <- full_join(tab2, waste_totgbl_mismanage, by = c("Entity"))
tab4 <- full_join(tab3, waste_inadequate_manage, by = c("Entity"))
tab5 <- full_join(tab4, gdp_per_cap, by = c("Entity"))
#tab6 <- left_join(tab5, country_gdp_capita, by = "Entity") not sure what year is the USD in.
```

```{r}
#write_csv(tab5, "Data Clean/master_table.csv")
write_csv(tab5, "Data Clean/data_1.csv")
```

*need to fix: some countries are spelt differently in different sources leading to duplicate rows that have NAs.
*very difficult to find data on total plastic produced by country in 2010.



```{r}
tab6 <- tab5
# Tidying up Entity names
tab6$Entity <- str_replace(tab6$Entity, ".*Bahamas.*", "Bahamas")
tab6$Entity <- str_replace(tab6$Entity, ".*Brunei.*", "Brunei")
tab6$Entity <- str_replace(tab6$Entity, "China, People's Republic of", "China")
tab6$Entity <- str_replace(tab6$Entity, "^Congo$", "Republic of Congo")
tab6$Entity <- str_replace(tab6$Entity, "Congo \\(Brazzaville\\)", "Republic of Congo")
tab6$Entity <- str_replace(tab6$Entity, "Congo, Republic of", "Republic of Congo")
tab6$Entity <- str_replace(tab6$Entity, "Congo \\(Kinshasa\\)", "Democratic Republic of Congo")
tab6$Entity <- str_replace(tab6$Entity, "Congo, Dem. Rep. of the", "Democratic Republic of Congo")
tab6$Entity <- str_replace(tab6$Entity, ".*C[ôo]te.*", "Cote d'Ivoire")
tab6$Entity <- str_replace(tab6$Entity, ".*Cura[cç]ao.*", "Curacao")
tab6$Entity <- str_replace(tab6$Entity, ".*Fa.?roe.*", "Faeroe Islands")
tab6$Entity <- str_replace(tab6$Entity, ".*Gambia.*", "The Gambia")
tab6$Entity <- str_replace(tab6$Entity, ".*Hong Kong.*", "Hong Kong")
tab6$Entity <- str_replace(tab6$Entity, "Korea, North", "North Korea")
tab6$Entity <- str_replace(tab6$Entity, "Korea, South", "South Korea")
tab6$Entity <- str_replace(tab6$Entity, "Korea, Republic of", "South Korea")
tab6$Entity <- str_replace(tab6$Entity, ".*Kyrgyz.*", "Kyrgyzstan")
tab6$Entity <- str_replace(tab6$Entity, ".*Lao.*", "Laos")
tab6$Entity <- str_replace(tab6$Entity, ".*Maca.*", "Macao")
tab6$Entity <- str_replace(tab6$Entity, ".*Micronesia.*", "Micronesia")
tab6$Entity <- str_replace(tab6$Entity, ".*Russia.*", "Russia")
tab6$Entity <- str_replace(tab6$Entity, ".*Saint Helena.*", "Saint Helena")
tab6$Entity <- str_replace(tab6$Entity, "São Tomé and Príncipe", "Sao Tome and Principe")
tab6$Entity <- str_replace(tab6$Entity, ".*Sint Maarten.*", "Sint Maarten")
tab6$Entity <- str_replace(tab6$Entity, ".*Slovak.*", "Slovakia")
tab6$Entity <- str_replace(tab6$Entity, ".*South Sudan.*", "South Sudan")  # South Sudan may need to be removed
tab6$Entity <- str_replace(tab6$Entity, ".*Taiwan.*", "Taiwan")
tab6$Entity <- str_replace(tab6$Entity, "Virgin Islands, British", "British Virgin Islands")


tab7 <- tab6 %>% 
          group_by(Entity) %>% 
          fill(everything(), .direction = "downup") %>% 
          slice(n=1)
```

* Congo Brazzaville (Republic of Congo) and Congo Kinshasa (Democratic Republic of Congo)
* country code: COG -> Republic of Congo; COD -> Democratic Republic of Congo
*Note: South Sudan and Sudan were one country until they split in 2011. Issue because data is 2010. Possibly take out the South Sudan row
*Not sure what to do about west bank and west bank and gaza



Fuel Subsidies  

*I am still not sure if I am sold on using 2015 data since the rest of our data is 2010. What happens if we have countries that actually didn't have subsidies available in 2010? It would not have any effect on the plastic waste generated 
```{r}
fuel_sub_raw <- read_csv("Data Raw/fossil-fuel-subsidies-gdp.csv") 

fuel_sub <- fuel_sub_raw %>% 
  mutate('Fossil-Fuel subsities as proportion of total GDP' = fuel_sub_raw$`12.c.1 - Fossil-fuel subsidies (consumption and production) as a proportion of total GDP (%) - ER_FFS_CMPT_GDP`) %>% 
  filter(Year == 2015) %>% 
  filter(!is.na(Code)) %>% 
  filter(Entity != c("World")) %>% 
  select(Entity, `Fossil-Fuel subsities as proportion of total GDP`)


#fuel_sub_codes <- fuel_sub_raw%>% select(Entity, Code, Year) %>% filter(Year == 2015) %>% select(!Year)

tab7 <- left_join(tab5, fuel_sub)
#tab8 <- left_join(tab7, fuel_sub_codes, by = c("Entity", "Code" = "Code"))

write_csv(tab7, "Data Clean/master_Table_Fuel.csv")

```





